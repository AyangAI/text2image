# 邀请码功能部署说明

## 功能概述
已为小程序添加邀请码功能，实现内测机制。用户注册时必须输入有效的邀请码才能成功注册。

## 部署步骤

### 1. 部署云函数
在微信开发者工具中，右键点击以下云函数并选择"上传并部署"：
- `generateInviteCodes` - 生成邀请码的云函数
- `register` - 已更新的注册云函数（包含邀请码验证）

### 2. 生成邀请码
部署完成后，在微信开发者工具的云开发控制台中：
1. 进入"云函数"页面
2. 找到 `generateInviteCodes` 函数
3. 点击"测试"按钮
4. 输入测试参数：
```json
{
  "count": 10
}
```
5. 点击"运行测试"，系统将生成10个随机邀请码并存储到数据库

### 3. 查看邀请码
在云开发控制台的"数据库"页面：
1. 找到 `invitationCodes` 集合
2. 查看生成的邀请码列表
3. 记录这些邀请码用于内测分发

## 邀请码规则
- 长度：8位
- 字符集：大写字母A-Z和数字0-9（排除易混淆字符I、O、0、1）
- 每个邀请码只能使用一次
- 使用后会标记为已使用状态

## 数据库结构
`invitationCodes` 集合字段：
- `_id`: 文档ID
- `code`: 邀请码（8位字符串）
- `isUsed`: 是否已使用（布尔值）
- `usedBy`: 使用者的openid（字符串，可选）
- `createdAt`: 创建时间（日期）
- `usedAt`: 使用时间（日期，可选）

## 注册流程
1. 用户在注册页面输入手机号、昵称、性别和邀请码
2. 前端验证邀请码格式（必须8位）
3. 后端验证邀请码是否存在且未使用
4. 验证通过后创建用户账户
5. 标记邀请码为已使用

## 测试建议
1. 使用有效邀请码测试注册成功流程
2. 使用无效邀请码测试注册失败流程
3. 使用已使用的邀请码测试重复使用限制
4. 验证邀请码使用后的状态更新

## 注意事项
- 请妥善保管生成的邀请码
- 建议定期检查邀请码使用情况
- 如需增加邀请码，可重新调用 `generateInviteCodes` 函数